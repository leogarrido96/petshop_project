{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    
    {% if user.is_staff and photos_to_validate %}
    <div class="alert alert-light border-warning shadow-sm mb-5">
        <h4 class="alert-heading fw-bold text-warning">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>Moderação Necessária
        </h4>
        <p>As fotos abaixo estão aguardando aprovação.</p>
        <hr>
        <div class="row g-3">
            {% for pending in photos_to_validate %}
            <div class="col-md-3">
                <div class="card h-100 shadow-sm">
                    <img src="{{ pending.image.url }}" class="card-img-top" style="height: 150px; object-fit: cover;">
                    <div class="card-footer d-flex gap-2">
                        <a href="{% url 'gallery:photo_action' pending.id 'approve' %}" class="btn btn-sm btn-success w-100">Aprovar</a>
                        <a href="{% url 'gallery:photo_action' pending.id 'reject' %}" class="btn btn-sm btn-danger w-100">Reprovar</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="mb-5">
        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center gap-3">
            <h2 class="fw-bold text-success mb-0">Galeria de Fotos</h2>
            
            {% if user.is_authenticated and not user.is_staff %}
                <a href="{% url 'gallery:photo_upload' %}" class="btn btn-success rounded-pill px-4 fw-bold shadow-sm">
                    <i class="bi bi-camera-fill me-2"></i>Enviar Foto
                </a>
            {% endif %}
        </div>
        <hr class="mt-3 opacity-10">
    </div>

    <div class="row g-4">
        {% for photo in photos %}
        <div class="col-md-4 col-sm-6">
            <div class="card border-0 shadow-sm h-100 rounded-4 overflow-hidden">
                <img src="{{ photo.image.url }}" 
                     class="card-img-top" 
                     alt="{{ photo.title }}" 
                     style="height: 250px; object-fit: cover; cursor: pointer;"
                     data-bs-toggle="modal" 
                     data-bs-target="#modal{{ photo.id }}">
                
                <div class="card-body text-center py-3">
                    <h6 class="fw-bold mb-1">{{ photo.title }}</h6>
                    {% if photo.caption %}
                        <p class="text-muted small mb-0">{{ photo.caption }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="modal fade" id="modal{{ photo.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content bg-transparent border-0">
                    <div class="modal-body p-0 text-center position-relative">
                        <img src="{{ photo.image.url }}" class="img-fluid rounded-4 shadow-lg" alt="{{ photo.title }}">
                        <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <div class="text-muted">
                <i class="bi bi-camera-reels fs-1 d-block mb-3"></i>
                <p>Ainda não temos fotos na nossa galeria.</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}